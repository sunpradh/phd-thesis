\newcommand{\InvSpace}[4]{\mathrm{Inv}\bqty{ V_{j_{#1}}^{\ast} \otimes V_{j_{#2}}^{\ast} \otimes V_{j_{#3}} \otimes V_{j_{#4}}}}
\newcommand{\jm}[1]{\ket{j_{#1} m_{#1}}}
\newcommand{\jn}[1]{\ket{j_{#1} n_{#1}}}
\newcommand{\jmn}[1]{\ket{j_{#1} m_{#1} n_{#1}}}

\section{The physical Hilbert space}\label{sec:physical Hilbert space}

As we remarked in Sec.~\ref{sub:the_hilbert_space}, while the overall Hilbert space of the pure gauge theory is $\HilbertTot = \bigotimes_{\link} \HilbertG_{\link}$, only those states that satisfy the so-called ``Gauss' law'' constraint \eqref{eq:lattice gauss law} are to be considered physical \cite{kogut1975hamiltonian, milstead2018qyangmills, tong2018gauge}.

For gauge theories based on most compact Lie groups, the Wilson loops (despite being overcomplete) span the space of gauge-invariant states \cite{sengupta1994gaugeinvariant, durhuus1980gaugeinvariant}.
This, however, is not necessarily true for finite groups \cite{sengupta1994gaugeinvariant, cui2020kitaev}; this means that in some cases, it is possible to construct different gauge-invariant states, which nevertheless have identical Wilson loops.
We mention that this difficulty does not arise for Abelian finite groups such as $\Z_N$, in which case the Wilson loops \emph{do} span the physical Hilbert space $\HilbertPhys$.

As will be discussed in Sec.~\ref{sec:spin networks pure gauge}, the gauge-invariant Hilbert space for pure gauge theories may be described in terms of \emph{spin network states}. This basis turns out to be particularly suitable for finite gauge groups and in Sec.~\ref{sub:dimension_physical_hilbert_space} we give a simple formula to compute the dimension of the physical Hilbert space for any finite gauge group.

\subsection{Spin network states}\label{sec:spin networks pure gauge}

The physical Hilbert space of pure gauge theories with either Lie or finite gauge group can be explicitly described in terms of \emph{spin network states} \cite{baez1996spinnetworks, burgio2000physical}.
Spin network states can be defined indifferently when the $d$-dimensional space is discretized as an arbitrary graph, and are thus valid in arbitrary dimension with arbitrary lattices and boundary conditions.

\medskip

The first key observation is that the action of the Gauss' law operator \eqref{eq:lattice gauss law} is block-diagonal in the representation basis, as can be seen from \eqref{eq:translations peter weyl}.
Then starting from the Hilbert space in the representation basis \eqref{eq:peterweyl}, we can, as usual, permute the summation and product, obtaining
\begin{equation}
    \label{eq:hilbert space permuted}
    \HilbertTot =
    \bigotimes_{\Lattice} \bigoplus_{j \in \Sigma} V_j^* \otimes V_j =
    \bigoplus_{\{j\} \in \{\Sigma\}} \bigotimes_{\link \in \Lattice}  V_{j_{\link}}^* \otimes V_{j_{\link}}.
\end{equation}
where now $\{j\}$ is an assignment of an irrep $j_{\link}$ to each lattice link $\link$, and $\{\Sigma\}$ is the set of the possible assignments.
The second key observation is that the gauge transformations \eqref{eq:lattice gauss law} are given by an independent group-valued variable $g_x$ at each site $x$ of the lattice.

Moreover, due to \eqref{eq:translations peter weyl} the gauge transformation associated to one site $x$ acts at most on one of the spaces $V_j$ or $V_j^*$ associated to a link, but it cannot act on both.
One can then split the two vector spaces $V_j$ and $V_j^*$ associated with each link and reorder the $V$'s in the tensor product over links so that $V_j$'s are now grouped together according to the \emph{sites} $x \in \Lattice$ and not the links,
\begin{equation}
    \HilbertTot =
    \bigoplus_{\{j\} \in \{\Sigma\}} \bigotimes_{x \in \Lattice} \pqty{\bigotimes_{\link_{-}=x} V_{j_{\link}}^*} \otimes \pqty{\bigotimes_{\link_{+}=x} V_{j_{\link}} }\ ,
\end{equation}
where by $\link_{+}$ and $\link_{-}$ we denote respectively the target and source vertex of link $\link$ (see Fig.~\ref{fig:periodic plaquette}).

\medskip

We can repeat the same set of operations for the gauge transformation operator \eqref{eq:gauss law operator}, which is therefore given by
\begin{equation}
    \mathcal{G}(\{g_x\}) =
    \bigoplus_{\{j\} \in \{\Sigma\}} \bigotimes_{x \in \Lattice} \pqty{\bigotimes_{\link_{-}=x} \rho_{j_{\link}}^*(g_x)} \otimes \pqty{\bigotimes_{\link_{+}=x} \rho_{j_{\link}}(g_x) }.
\end{equation}
In the above decomposition, the gauge transformations now act independently for each $x$ and the Gauss' law constraint \eqref{eq:lattice gauss law} gives the physical Hilbert space
\begin{equation}
    \label{eq:spin network Hilbert space}
    \HilbertPhys = \bigoplus_{\{j\} \in \{\Sigma\}} \bigotimes_{x \in \Lattice} \mathrm{Inv}\bqty{\pqty{\bigotimes_{\link_{-}=x} V_{j_{\link}}^*} \otimes \pqty{\bigotimes_{\link_{+}=x} V_{j_{\link}} }}.
\end{equation}
Given a representation $\rho$ (not necessarily irreducible) with representation space $V_\rho$, the \emph{set of invariant vectors} $\mathrm{Inv}(V_\rho)$ is the set of vectors $v \in V_\rho$ such that $\rho(g) v = v$ for all $g\in G$.
Note that this is a \emph{separate notion} from that of an ``invariant subspace''.
The characterization of the Hilbert space \eqref{eq:spin network Hilbert space} implies that any physical, gauge-invariant state $\ket{\Psi}$ (i.e.
a state which satisfies the Gauss' law \eqref{eq:lattice gauss law}) may be expanded in a basis of \emph{spin network states},
\begin{equation}
    \ket{\Psi} = \sum_{ \{j\} } \sum_{ A } \Psi(\{j\}; A) \ket{\{j\},A}, \qquad \ket{\{j\},A} = \bigotimes_{x \in \Lattice} \ket{\{j\}_x,a_x},
\end{equation}
where $\{j\}$ is an assignment of irreps to lattice links and $A=(a_1, \ldots a_V)$ is a multi-index which labels the choice of a basis element of invariant states at each site.
With $\{j\}_x$ we denote the irreps assigned to the links connected to site $x$.

For a hypercubic lattice in $d$ dimensions with periodic boundary conditions, each site is connected to $2d$ links and therefore $2d$ terms appear in the tensor product within each $\mathrm{Inv}$ in \eqref{eq:spin network Hilbert space}.
If instead we choose open boundary conditions, the sites in the bulk will again be connected to $2d$ links, but the sites on the boundary will be connected to fewer links and thus fewer terms will appear in the tensor product for those sites.
In the general case, the number of terms in the tensor product within each $\mathrm{Inv}$ will thus depend on the site.

We choose to work directly with the spaces of invariant vectors rather than with spaces of intertwiners more commonly employed in the literature on spin-network states \cite{baez1996spinnetworks, burgio2000physical}.
We also would like to note that the physical Hilbert space \eqref{eq:spin network Hilbert space} contains \emph{all} gauge-invariant states, possibly also including states in sectors with a non-contractible Wilson line.

\medskip

The calculation of a basis of invariant states (or, equivalently, of the intertwiners) can be difficult in the Lie group case, especially since they admit infinitely many irreps.
On the other hand, since the number of links connected to each site is finite and independent of the lattice volume, one needs only compute the invariant states of a finite number of tensor product representations which does not scale with the lattice volume.

This can be achieved in practice by explicitly writing out the matrices of the tensor product representation
\begin{equation*}
    \rho(g) \equiv \pqty{\bigotimes_{\link_{-}=x} \rho_{j_{\link}}^*} \otimes \pqty{\bigotimes_{\link_{+}=x} \rho_{j_{\link}} }
\end{equation*}
and solving the simultaneous equations $\rho(g) v = v$ for a set of generators of $G$.
In a $d$-dimensional periodic hypercubic lattice, the number of terms in the tensor product equals $2d$ and the maximum dimension of the tensor product representation is bounded by $\pqty{\dim{j}}^{2d} \leq \abs{G}^d$, owing to $\sum_j \pqty{\dim{j}}^2 = \abs{G}$, independently from the lattice volume.

\bigbreak

\begin{figure}[t]
    \centering
    \input{assets/figures/lattice_2x2.tex}
    \caption[Periodic square $2 \times 2$ lattice]{\emph{Left}: a $2\times 2$ square lattice with periodic boundary conditions, showing the labels of the links.
        \emph{Right}: labelling of sites attached to a link.}
    \label{fig:periodic plaquette}
\end{figure}

As an example, we work out explicitly the case of a $2\times 2$ square lattice with periodic boundary conditions.
As shown in Fig.~\ref{fig:periodic plaquette}, this system has four vertices and eight links.
Expanding explicitly \eqref{eq:spin network Hilbert space} we see that in this case
\begin{equation}
    \begin{split}
        \HilbertPhys = \bigoplus_{j_1, \ldots j_8} \Bigg(
            & \InvSpace{1}{4}{5}{8} \otimes
              \InvSpace{5}{2}{1}{7} \otimes \\
            & \InvSpace{6}{7}{3}{2} \otimes
              \InvSpace{3}{8}{6}{4}
         \Bigg)
    \end{split}
\end{equation}
Now consider a single invariant subspace $\mathrm{Inv}\bqty{V_{j_1}^* \otimes V_{j_2}^* \otimes V_{j_3} \otimes V_{j_4}}$ with arbitrary assignment of irreps.
This vector space admits an orthonormal basis $\{\ket{j_1 j_2 j_3 j_4 ; a}\}$ where $1 \leq a \leq \dim\mathrm{Inv}\bqty{V_{j_1}^* \otimes V_{j_2}^* \otimes V_{j_3} \otimes V_{j_4}}$ indexes the basis vector.
We can expand the basis vectors explicitly in terms of the bases of the $V_j$ as (see also the discussion around \eqref{eq:change_of_basis})
\begin{multline}
    \label{eq:invariant states at a site}
    \ket{j_1 j_2 j_3 j_4 ; a} = \sum_{m_1, m_2, n_3, n_4} \psi\pqty{j_1 m_1 j_2 m_2 j_3 n_3 j_4 n_4 ; a} \times \\
        \times \jm{1} \jm{2} \jn{3} \jn{4}.
\end{multline}
The basis vectors can be chosen to be orthonormal.
By virtue of spanning the space $\mathrm{Inv}\bqty{V_{j_1}^* \otimes V_{j_2}^* \otimes V_{j_3} \otimes V_{j_4}}$, they are invariant vectors of the tensor product representation $\rho \equiv \rho_{j_1}^* \otimes \rho_{j_2}^* \otimes \rho_{j_3} \otimes \rho_{j_4}$; as such, they satisfy $\rho(g) \ket{j_1 j_2 j_3 j_4 ; a} = \ket{j_1 j_2 j_3 j_4 ; a}$ for all $g \in G$.
The coefficients of the expansion $\psi\pqty{j_1 m_1 j_2 m_2 j_3 n_3 j_4 n_4 ; a}$ may be easily computed, for example by writing the tensor product representation matrices $\rho(g)$ explicitly and then solving the simultaneous equations $\rho(g) v = v$.
The dimension of the space of invariant vectors depends on the four representations assigned to the relevant site.
Now let $A = \pqty{a_1, a_2, a_3, a_4}$, which implicitly depends on $\{j\}$ (because the range of each $a_x$ depends on the irreps assigned around the site $x$).
Given any assignment of irreps $\{j\}$, $A$ is a choice of a basis vector of invariant states at the four sites.
Therefore an orthonormal basis for the gauge invariant Hilbert space is given by
\begin{equation}
    \ket{ \{j\};A} = \ket{j_1 j_4 j_5 j_8 ; a_1} \otimes \ket{j_5 j_2 j_1 j_7 ; a_2} \otimes \ket{j_6 j_7 j_3 j_2 ; a_3} \otimes \ket{j_3 j_8 j_6 j_4 ; a_4}.
\end{equation}
for any possible assignment $\{j\}$ of irreps to links, and then all possible choices $A$ of an invariant vector at each of the four sites. The spin-network states $\ket{ \{j\};A}$ then form a basis of the gauge-invariant Hilbert space $\HilbertPhys$.
Expanding the tensor product, we find an explicit expression for these states in terms of the representation basis,
\begin{align}
    \label{eq:spin network states 2x2}
    \ket{ \{j\};A} &= \sum_{n_1, \ldots n_8} \sum_{m_1, \ldots m_8} \psi\pqty{j_1 m_1 j_4 m_4 j_5 n_5 j_8 n_8 | a_1} \psi\pqty{j_5 m_5 j_2 m_2 j_1 n_1 j_7 n_7 | a_2} \times \nonumber \\
    &\quad \quad \times \psi\pqty{j_6 m_6 j_7 m_7 j_3 n_3 j_2 n_2 | a_3} \psi\pqty{j_3 m_3 j_8 m_8 j_6 n_6 j_4 n_4 | a_4} \times \\
    &\quad \quad \times \jmn{1} \jmn{2} \cdots \jmn{8} \nonumber.
\end{align}
where we have restored the ordering of the vector spaces $V_j$s and used again the shorthand $\ket{jmn}=\ket{jm}\otimes \ket{jn}$. We note in particular that despite having introduced a splitting of the variables at each link, in the final answer this splitting disappears and the spin-network states can be  entirely expressed in terms of the representation basis $\ket{jmn}$.

\subsection{The dimension of the physical Hilbert space}
\label{sub:dimension_physical_hilbert_space}

As we have seen in the previous section, spin network states give an explicit description of the physical Hilbert space $\HilbertPhys$ as
\begin{equation}
    \HilbertPhys =\bigoplus_{\{\rho\} \in \{\Sigma\}} \bigotimes_{v \in \Lattice} \mathrm{Inv}\bqty{\pqty{\bigotimes_{\link_{-} = v}  V_{\rho_l}^*} \otimes \pqty{\bigotimes_{\link_{+} = v}  V_{\rho_l}}}.
\end{equation}
where $\mathrm{Inv}(\rho)$ is the space of invariant vectors of the representation $\rho$, $\{\rho\}$ is an assignment of irreps to links and $\{\Sigma\}$ is the set of such possible assignments. For a finite group,
\begin{equation}
    \label{eq:invariant vectors counting}
    \dim{\mathrm{Inv}(\rho)} = \frac{1}{\abs{G}} \sum_{g \in G} \chi_\rho(g).
\end{equation}
where $\chi_\rho$ is the character of $\rho$. A proof of this result can be found in Appendix \ref{sec:counting invariant states}. This fact can be used to obtain a general formula for the dimension of the $\HilbertPhys$, which is valid for any lattice in any dimension with any boundary conditions. On a connected lattice with $L$ links and $V$ sites, we will show that
\begin{equation}
    \label{eq:physical hilbert space dimension}
    \dim{\HilbertPhys} = \sum_C \pqty{\frac{\abs{G}}{\abs{C}}}^{L-V}.
\end{equation}
where the sum runs over all conjugacy classes $C$ of the group, and $\abs{C}$ is the size of $C$. The ratio $\abs{G}/\abs{C}$ is always an integer by the orbit-stabilizer theorem \cite{serre1967representations}.
Since for a connected graph $L-V \geq -1$, the $\dim{\HilbertPhys}$ in \eqref{eq:physical hilbert space dimension} is always an integer.
This is clear for $L-V \geq 0$; when $L-V=-1$ the graph is a tree and since $\sum_C \abs{C}=\abs{G}$, we find $\dim{\HilbertPhys}=1$; this is to be expected because on a tree the gauge degrees of freedom can be used to rotate away the physical ones.

Using \eqref{eq:invariant vectors counting}, together with the fact that the character of a tensor product is given by the product of the characters, we may readily prove \eqref{eq:physical hilbert space dimension}. From the general formula for the gauge-invariant Hilbert space, we have
\begin{align}
    \dim{\HilbertPhys} &=\sum_{j_1 j_2 \cdots j_L} \prod_{x \in \Lattice} \dim\mathrm{Inv}\bqty{\pqty{\bigotimes_{\link_{-} = x}  V_{\rho_l}^*} \otimes \pqty{\bigotimes_{\link_{+} = x}  V_{\rho_l}}} = \nonumber \\
    &=\frac{1}{\abs{G}^V}\sum_{j_1 j_2 \cdots j_L} \sum_{g_1 g_2 \cdots g_V} \prod_{x \in \Lattice} \pqty{\prod_{\link_{-} = x}  \chi_{j_{\link}}^*(g_x)}  \pqty{\prod_{\link_{+} = x} \chi_{j_{\link}}(g_x)} \nonumber.
\end{align}
Within the product over all sites, there are exactly $2L$ factors of characters $\chi$, as each link contributes two representation spaces $V$ and each representation space gives rise to a character. Thus grouping characters by link, we obtain
\begin{equation}
    \dim{\HilbertPhys} =\frac{1}{\abs{G}^V} \sum_{g_1 g_2 \cdots g_V} \prod_{\link = \expval{xx'} \in \Lattice} \expval{g_x, g_{x'}}.
\end{equation}
where we denoted $\expval{g, h} = \sum_j \chi_j(g)^* \chi_j(h)$. It is a well-known result that $\expval{g, h}$ is zero unless $g$ and $h$ belong to the same conjugacy class, in which case $\expval{g, h} = \abs{G} / \abs{C}$ where $C$ is the conjugacy class of both $g$ and $h$ \cite{serre1967representations}. If any two adjacent sites $x$ and $x'$ have $g_x$ and $g_{x'}$ in different conjugacy classes, then $\expval{g_x, g_{x'}}=0$ and the corresponding term in the sum is zero. Assuming that the lattice is connected, this implies that the product over all links is zero unless all the $g_x$ at each site $x$ belong to the same conjugacy class. Then, since $\expval{g_x, g_{x'}}$ is constant on conjugacy classes, we can write
\begin{equation}
    \dim{\HilbertPhys}
    =\frac{1}{\abs{G}^V} \sum_C \sum_{g_1 g_2 \cdots g_V \in C} \frac{\abs{G}^L}{\abs{C}^L} = \sum_C  \pqty{\frac{\abs{G}}{\abs{C}}}^{L-V}.
\end{equation}
which concludes the proof.
In the Abelian case the above formula simplifies as all conjugacy classes are singlets and therefore $\dim{\HilbertPhys} = \abs{G}^{L-V+1}$.
Thus finite Abelian groups have the largest physical Hilbert space among all groups of the same order.
For periodic boundary conditions in a hypercubic lattice, $L=Vd$ and as such $\dim{\mathcal{H}}=\abs{G}^{Vd}$, while $\dim{\HilbertPhys} \approx \abs{G}^{V (d-1)}$, so that the physical Hilbert space has roughly the same size as the overall Hilbert space in one lower dimension.
Nonetheless, both spaces grow exponentially with the lattice size.

\medskip

As a further example, we consider the dimension of the Hilbert space for pure $D_4$ gauge theory.
Using \eqref{eq:physical hilbert space dimension}, we find for $G=D_4$ on a lattice with $L$ links and $V$ sites (see also \cite{marchesethesis}),
\begin{equation}
    \dim{\HilbertPhys} = 8^{L-V}\pqty{2+\frac{3}{2^{L-V}}}.
\end{equation}
The dimension of the physical Hilbert space for some two-dimensional finite square lattices in $2+1$ dimensions is shown in Table \ref{tab:numstates}. We see that its size grows quickly with the lattice size. We point out that even for a $2 \times 2$ periodic lattice with a small group such as $D_4$ it is not practical to write down all possible gauge-invariant states. Unless the structure happens to be very sparse, writing down the $8960$ physical basis elements in terms of the $\abs{G}^L = 8^8$ basis elements in the representation basis using $4 \mathrm{B}$ floating point numbers would require roughly $600 \,\mathrm{GB}$ of memory. For a  $3 \times 3$ periodic lattice this number rises to $20\, \mathrm{YB}$ or $2 \cdot 10^{16}\, \mathrm{GB}$.


Finally, we remark that since matter fields are site-based, the spin-network states may be extended to this case as well; the physical Hilbert space would then be given again by \eqref{eq:spin network Hilbert space} with an extra factor of the matter Hilbert space at each site within each $\mathrm{Inv}$. The detailed description of the gauge-invariant Hilbert space with matter fields will be given in a future publication.


\begin{table}[t]
    \centering
    \begin{tabular}{clrrcr}
        \toprule
        Size~~~ & BCs & $L$ & $V$ & $L-V$ &$\dim{\HilbertPhys}$\\
        \midrule
        \multirow{2}{3em}{$2 \times 2$}
            & open & $4$ & $4$ & $0$ & $5$\\
            & periodic & $8$ & $4$ & $4$ & $8960$ \\[5pt]
        \multirow{2}{3em}{$2 \times 3$}
            & open & $7$ & $6$ & $1$ & $28$ \\
            & periodic & $12$ & $6$ & $6$ & $536576$ \\[5pt]
        \multirow{2}{3em}{$3 \times 3$}
            & open & $12$ & $9$ & $3$ & $1216$ \\
            & periodic & $18$ & $9$ & $9$ & $269221888$ \\
        \bottomrule
    \end{tabular}
    \caption{Dimension of the physical subspace of $D_4$ gauge theory on some small lattices in $2+1$ dimensions. $L$ is the number of links and $V$ is the number of vertices.}
    \label{tab:numstates}
\end{table}



