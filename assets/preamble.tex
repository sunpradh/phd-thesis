%======================================================================
% PREAMBLE
%======================================================================

%----------------------------------------
% DOCUMENT APPEARANCE
%----------------------------------------

% Fonts
%----------------------------------------
\usepackage[no-math]{fontspec}
\usepackage[T1]{fontenc}
\usepackage{mlmodern}
\setsansfont{IBM Plex Sans}
\newfontfamily{\PlexMedium}{IBM Plex Sans Medm} % for headings


% Custom chapter heading style
%----------------------------------------
\makechapterstyle{mychapter}{
    \chapterstyle{companion}
    \setlength{\beforechapskip}{0cm}
    \setlength{\afterchapskip}{2.5cm}
    \setlength{\topskip}{0cm}
    \setlength{\midchapskip}{5pt}
    \setlength{\chapindent}{0.75\marginparsep}
    \addtolength{\chapindent}{0.75\marginparwidth}
    \renewcommand*{\chapnamefont}{}
    \renewcommand*{\printchaptername}{}
    \renewcommand*{\chapnumfont}{\sffamily\LARGE\bfseries}
    \renewcommand*{\printchapternum}{%
        \raggedleft\chapnumfont %
        \ifanappendix appendix~ \thechapter %
        \else chapter~ \numtoname{\thechapter}\fi%
    }
    \renewcommand*{\chaptitlefont}{\normalfont\sffamily\HUGE}
    \renewcommand{\printchaptertitle}[1]{%
        \begin{adjustwidth}{\chapindent}{-\chapindent}
            \raggedleft \chaptitlefont ##1\par\nobreak
        \end{adjustwidth}
    }
}


% Custom section style
%----------------------------------------
\setsecnumdepth{subsection}
\settocdepth{subsection}
\hangsecnum
\makeheadstyles{myheadings}{
    \renewcommand*{\secheadstyle}{\sffamily\Large\PlexMedium}
    \renewcommand*{\subsecheadstyle}{\sffamily\large\PlexMedium}
    \renewcommand*{\subsubsecheadstyle}{\sffamily\normalsize\PlexMedium}
}


% Custom page style
%----------------------------------------
\setlength{\headwidth}{\textwidth}
\addtolength{\headwidth}{0.75\marginparsep}
\addtolength{\headwidth}{0.75\marginparwidth}
\makepagestyle{mypagestyle}
\makerunningheadwidth{mypagestyle}{\headwidth}
\makeheadrule{mypagestyle}{\headwidth}{\normalrulethickness}
\makeheadposition{mypagestyle}{flushright}{flushleft}{}{}
\makepsmarks{mypagestyle}{%
    \nouppercaseheads
    \createmark{chapter}{both}{nonumber}{}{}
    \createmark{section}{right}{nonumber}{}{}
    \createplainmark{toc}{both}{\contentsname}
    \createplainmark{lof}{both}{\listfigurename}
    \createplainmark{lot}{both}{\listtablename}
    \createplainmark{bib}{both}{\bibname}
    \createplainmark{index}{both}{\indexname}
    \createplainmark{glossary}{both}{\glossaryname}
}

% Headers
\makeevenhead{mypagestyle}{\normalfont\sffamily\PlexMedium\rightmark}{}{}
\makeoddhead{mypagestyle}{}{}{\normalfont\PlexMedium\leftmark}

% Footers
\makeevenfoot{mypagestyle}{}{\normalfont\PlexMedium\thepage}{}
\makeoddfoot{mypagestyle}{}{\normalfont\PlexMedium\thepage}{}
\addtolength{\footskip}{20pt}

% Fix chapter page style
\copypagestyle{chapter}{plain}
\makeevenfoot{chapter}{}{\normalfont\PlexMedium\thepage}{}
\makeoddfoot{chapter}{}{\normalfont\PlexMedium\thepage}{}


% Set all the custom styles
\headstyles{myheadings}
\chapterstyle{mychapter}
\pagestyle{mypagestyle}

% Custom caption style
%----------------------------------------
\captiondelim{.\hspace{1em}}
\captionnamefont{\footnotesize\PlexMedium}
\captiontitlefont{\footnotesize\sffamily}
\captionstyle{\linespread{1.1}}

% Macro for figure with caption on the side
\usepackage{xifthen}

\newcommand{\FigureSideCaption}[3][]{
    \begin{minipage}[t]{0.5\textwidth}
        \centering
        #2
    \end{minipage}\hfill
    \begin{minipage}[b]{0.45\textwidth}
        \caption{#3}%
        \ifthenelse{\isempty{#1}}{}{\label{#1}}%
    \end{minipage}%
}

% Line spacing
\linespread{1.1}

%----------------------------------------
% MATH
%----------------------------------------
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{physics}
\usepackage{bm}
\usepackage{bbm}
\usepackage{slashed}
\usepackage{amsthm}


% Show equation labels
\usepackage[]{showlabels}
\renewcommand{\showlabelfont}{\scriptsize\sffamily\color{gray}}

% Math macros
\input{assets/math_macros.tex}

% Theorems environment
\newtheorem{theorem}{Theorem}
\newtheorem{corollary}{Corollary}


%----------------------------------------
% GRAPHICS
%----------------------------------------
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{subfloat}

% Custom colors
% load IBM Carbon theme
\usepackage{xcolor}
\input{assets/carbon_theme.tex}
\colorlet{Blue}{Blue80}
\colorlet{Gray}{Grey70}

% TikZ
\input{assets/tikz_settings.tex}

% Plots
\usepackage{pgfplots}
\pgfplotsset{compat=1.16} % fixes some pgfplots cross-platform issue
\usepgfplotslibrary{groupplots}

%----------------------------------------
% MISC
%----------------------------------------
\usepackage[colorlinks, linkcolor=blue, urlcolor=Blue]{hyperref}
\usepackage{bookmark}
\usepackage{dirtytalk}
% Lists
\usepackage{enumitem}
% Tables
\usepackage{booktabs}
\usepackage{multirow}

\usepackage{xspace}
\newcommand{\dof}{d.o.f.\xspace}

% macro for TODO notes
\newcommand{\todo}[1]{\textcolor{red}{[ \textsf{#1} ]}}
% macro for missing citations
\newcommand{\citneeded}{\textcolor{red}{\textsf{\textsuperscript{[citation?]}}}}


%----------------------------------------
% Bibliography
%----------------------------------------
\usepackage[style=numeric-comp, sorting=none, bibstyle=nature]{biblatex}
\bibliography{assets/biblio.bib}

\ExecuteBibliographyOptions{doi=false}
\ExecuteBibliographyOptions{url=false}
\newbibmacro{string+doi}[1]{%
  \iffieldundef{doi}{#1}{\href{http://dx.doi.org/\thefield{doi}}{#1}}}
\DeclareFieldFormat{title}{\usebibmacro{string+doi}{\mkbibemph{#1}}}
\DeclareFieldFormat[article]{title}{\usebibmacro{string+doi}{\mkbibquote{#1}}}


%----------------------------------------
% Macros for front page
%----------------------------------------
% TODO: forse un po' ridondanti
% Variables
\newcommand{\thephdcoordinator}{}
\newcommand{\thesupervisor}{}
\newcommand{\thecosupervisor}{}
\newcommand{\ilsettoreconcorsuale}{}
\newcommand{\ilsettoredisciplinare}{}

\newcommand{\phdcoordinator}[1]{\renewcommand{\thephdcoordinator}{#1}}
\newcommand{\supervisor}[1]{\renewcommand{\thesupervisor}{#1}}
\newcommand{\cosupervisor}[1]{\renewcommand{\thecosupervisor}{#1}}
\newcommand{\settoreconcorsuale}[1]{\renewcommand{\ilsettoreconcorsuale}{#1}}
\newcommand{\settoredisciplinare}[1]{\renewcommand{\ilsettoredisciplinare}{#1}}


%----------------------------------------
% Acronyms
%----------------------------------------
\usepackage{acro}

\DeclareAcronym{sm}{short={SM}, long={Statistical Mechanics}}
\DeclareAcronym{ym}{short={YM}, long={Yang-Mills}}
\DeclareAcronym{qft}{short={QFT}, long={Quantum Field Theory}}
\DeclareAcronym{qcd}{short={QCD}, long={Quantum Chromodynamics}}
\DeclareAcronym{qed}{short={QED}, long={Quantum Electrodynamics}}
\DeclareAcronym{lft}{short={LFT}, long={Lattice Field Theory}}
\DeclareAcronym{lgt}{short={LGT}, long={Lattice Gauge Theory}}
% TODO da implementare
\DeclareAcronym{tc}{short={TC}, long={Toric Code}}
\DeclareAcronym{wl}{short={WL}, long={Wilson loop}}
\DeclareAcronym{ths}{short={tHS}, long={'t Hooft string}}
\DeclareAcronym{qs}{short={QS}, long={Quantum Simulation}}
\DeclareAcronym{dqs}{short={DQS}, long={Digital Quantum Simulation}}
\DeclareAcronym{aqs}{short={AQS}, long={Analog Quantum Simulation}}
\DeclareAcronym{dof}{short={d.o.f.}, long={degrees of freedom}}
\DeclareAcronym{DCPT}{short={DCPT}, long={deconfined-confined phase transition}}
