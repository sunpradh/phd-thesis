%======================================================================
% PREAMBLE
%======================================================================

%----------------------------------------
% DOCUMENT APPEARANCE
%----------------------------------------

% Fonts
%----------------------------------------
\usepackage{fontspec}
\usepackage{mlmodern}
\usepackage[T1]{fontenc}
\setsansfont{IBM Plex Sans}
\newfontfamily{\PlexMedium}{IBM Plex Sans Medm}


% Custom chapter heading style
%----------------------------------------
\makechapterstyle{mychapter}{
    \chapterstyle{companion}
    \setlength{\beforechapskip}{0cm}
    \setlength{\topskip}{0cm}
    \setlength{\midchapskip}{5pt}
    \renewcommand*{\chapnamefont}{}
    \renewcommand*{\printchaptername}{}
    \renewcommand*{\chapnumfont}{\sffamily\LARGE\bfseries}
    \renewcommand*{\printchapternum}{%
        \raggedleft\chapnumfont %
        \ifanappendix appendix~ \thechapter %
        \else chapter~ \numtoname{\thechapter}\fi%
    }
    \setlength{\chapindent}{0.75\marginparsep}
    \addtolength{\chapindent}{0.75\marginparwidth}
    \renewcommand*{\chaptitlefont}{\normalfont\sffamily\HUGE}
    \renewcommand{\printchaptertitle}[1]{%
        \begin{adjustwidth}{\chapindent}{-\chapindent}
            \raggedleft \chaptitlefont ##1\par\nobreak
        \end{adjustwidth}
    }
}


% Custom section style
%----------------------------------------
\setsecnumdepth{subsection}
\settocdepth{subsection}
\hangsecnum
\makeheadstyles{myheadings}{
    \renewcommand*{\secheadstyle}{\sffamily\Large\PlexMedium}
    \renewcommand*{\subsecheadstyle}{\sffamily\large\PlexMedium}
    \renewcommand*{\subsubsecheadstyle}{\sffamily\normalsize\PlexMedium}
}


% Custom page style
%----------------------------------------
\setlength{\headwidth}{\textwidth}
\addtolength{\headwidth}{0.75\marginparsep}
\addtolength{\headwidth}{0.75\marginparwidth}
\makepagestyle{mypagestyle}
\makerunningheadwidth{mypagestyle}{\headwidth}
\makeheadrule{mypagestyle}{\headwidth}{\normalrulethickness}
\makeheadposition{mypagestyle}{flushright}{flushleft}{}{}
\makepsmarks{mypagestyle}{%
    \nouppercaseheads
    \createmark{chapter}{both}{nonumber}{}{}
    \createmark{section}{right}{nonumber}{}{}
    \createplainmark{toc}{both}{\contentsname}
    \createplainmark{lof}{both}{\listfigurename}
    \createplainmark{lot}{both}{\listtablename}
    \createplainmark{bib}{both}{\bibname}
    \createplainmark{index}{both}{\indexname}
    \createplainmark{glossary}{both}{\glossaryname}
}

% Headers
\makeevenhead{mypagestyle}{\normalfont\sffamily\PlexMedium\rightmark}{}{}
\makeoddhead{mypagestyle}{}{}{\normalfont\PlexMedium\leftmark}

% Footers
\makeevenfoot{mypagestyle}{}{\normalfont\PlexMedium\thepage}{}
\makeoddfoot{mypagestyle}{}{\normalfont\PlexMedium\thepage}{}
\addtolength{\footskip}{20pt}

% Fix chapter page style
\copypagestyle{chapter}{plain}
\makeevenfoot{chapter}{}{\normalfont\PlexMedium\thepage}{}
\makeoddfoot{chapter}{}{\normalfont\PlexMedium\thepage}{}


% Set all the custom styles
\headstyles{myheadings}
\chapterstyle{mychapter}
\pagestyle{mypagestyle}

% Line spacing
\linespread{1.1}

%----------------------------------------
% MATH
%----------------------------------------
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{physics}
\usepackage{bm}
\usepackage{bbm}
\usepackage{slashed}

% Show equation labels
\usepackage[]{showlabels}
\renewcommand{\showlabelfont}{\scriptsize\sffamily\color{gray}}

% Math macros

\newcommand{\R}{\mathbb{R}} % Real field
\newcommand{\Z}{\mathbb{Z}} % integers
\newcommand{\C}{\mathbb{C}} % Complex field
\newcommand{\onehalf}{$\frac{1}{2}$} % 1/2
\newcommand{\identity}{\mathbbm{1}} % identity operator
\newcommand{\phys}{\text{phys}} % 'physical' label
\newcommand{\gi}{\text{gi}} % gauge-invariant label
\newcommand{\hc}{\text{h.c.}} % hermitian conjugate text
\newcommand{\W}{W_{\square}} % single plaquette Wilson loop
\newcommand{\action}{\mathcal{S}} % action
\newcommand{\HamilKS}{H_{\text{KS}}} % Kogut-Susskind Hamiltonian
\newcommand{\HilbertSpace}{\mathcal{H}} % Hilbert space
% Groups and algebra
\newcommand{\U}{\mathrm{U}} % unitary group
\newcommand{\SU}{\text{SU}} % special unitary group
\newcommand{\su}{\mathfrak{su}} % special unitary algebra
\newcommand{\g}{\mathfrak{g}} % Lie algebra
%
\newcommand{\generator}{\hat{\ell}}
\newcommand{\transport}{\hat{u}}
\newcommand{\Hphys}{\HilbertSpace_{\phys}} % physical Hilbert space
\newcommand{\HIsing}{H_{\text{Ising}}} % Ising Hamiltonian
\newcommand{\Hclock}{H_{\text{clock}}} % Clock Hamiltonian
% shorthand for links on the ladder
\newcommand{\lattice}{\mathbb{L}} % lattice
\newcommand{\link}{\ell} % link
\newcommand{\toplink}{\link^\uparrow}
\newcommand{\botlink}{\link^\downarrow}
\newcommand{\runglink}{\link^0}
% shorthand for electric operators and comparators on the ladder
\newcommand{\Uup}{U^{\uparrow}}
\newcommand{\Udown}{U^{\downarrow}}
\newcommand{\Urung}{U^0}
\newcommand{\Vup}{V^{\uparrow}}
\newcommand{\Vdown}{V^{\downarrow}}
\newcommand{\Vrung}{V^0}
% Gauss operators
\newcommand{\GaussUp}{G^{\uparrow}}
\newcommand{\GaussDown}{G^{\downarrow}}
% shorthand for the coefficients of the ladder duality map
\newcommand{\coeffup}{c^{\uparrow}}
\newcommand{\coeffdown}{c^{\downarrow}}

\newcommand{\Or}{\mathrm{O}}


% redefine some math macro
\renewcommand{\dd}{\text{d}}
\renewcommand{\tr}{\text{tr}}
\renewcommand{\exp}{\text{exp}}
\renewcommand{\laplacian}{\Delta}


%----------------------------------------
% GRAPHICS
%----------------------------------------
\usepackage{xcolor}
\usepackage{graphicx}

% TikZ
\usepackage{tikz}
\usetikzlibrary{arrows.meta, decorations.markings, patterns, fit, positioning}
\tikzset{font=\small, >={Latex}}
\tikzset{->-/.style={decoration={markings,
  mark=at position #1 with {\arrow{>}}},postaction={decorate}}}
\tikzset{-<-/.style={decoration={markings,
  mark=at position #1 with {\arrow{<}}},postaction={decorate}}}

% TikZ caching
\usetikzlibrary{external}
\tikzset{external/system call={lualatex -shell-escape -halt-on-error -interaction=batchmode -enable-write18 -jobname "\image" "\texsource"}}
\tikzexternalize[prefix=assets/cache/] % folder for cache

% Plots
\usepackage{pgfplots}
\pgfplotsset{compat=1.16} % fixes some pgfplots cross-platform issue
\usepgfplotslibrary{groupplots}

\usepackage{wrapfig}

% custom colors
\usepackage{xcolor}
\colorlet{Red}{red!70!black}
\colorlet{Blue}{blue!70!black}
\colorlet{Gray}{gray!70!black}
\colorlet{Green}{green!70!black}

%----------------------------------------
% MISC
%----------------------------------------
\usepackage[colorlinks, linkcolor=blue, urlcolor=Blue]{hyperref}
\usepackage{bookmark}
\usepackage{dirtytalk}

% Title and author
\title{Finite Group Lattice Gauge Theories for Quantum Simulation}
\author{Sunny Pradhan}
\date{}

% macro for TODO notes
\newcommand{\todo}[1]{\textcolor{red}{[ \textsf{#1} ]}}
% macro for missing citations
\newcommand{\citneeded}{\textcolor{red}{\textsf{\textsuperscript{[citation?]}}}}


%----------------------------------------
% Bibliography
%----------------------------------------
\usepackage[style=numeric, bibstyle=nature]{biblatex}
\bibliography{assets/biblio.bib}

\ExecuteBibliographyOptions{doi=false}
\ExecuteBibliographyOptions{url=false}
\newbibmacro{string+doi}[1]{%
  \iffieldundef{doi}{#1}{\href{http://dx.doi.org/\thefield{doi}}{#1}}}
\DeclareFieldFormat{title}{\usebibmacro{string+doi}{\mkbibemph{#1}}}
\DeclareFieldFormat[article]{title}{\usebibmacro{string+doi}{\mkbibquote{#1}}}
